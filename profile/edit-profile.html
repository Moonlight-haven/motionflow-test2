<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edit Profile - Motion-Flow</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --color-dark: #0a0a12;
      --color-bg: #0f0f1a;
      --color-bg-light: #1a1a2e;
      --color-primary: #00bcd4;
      --color-accent: #00bcd4;
      --color-accent-alt: #f97316;
      --color-text: #e2e8f0;
      --color-text-muted: #94a3b8;
      --color-success: #10b981;
      --color-error: #ef4444;
      --font-heading: 'Orbitron', sans-serif;
      --font-body: 'Inter', sans-serif;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: var(--font-body);
    }

    body {
      margin: 0;
      min-height: 100vh;
      background-color: var(--color-bg);
      color: var(--color-text);
      overflow-x: hidden;
      position: relative;
      touch-action: pan-y;
      overflow-x: hidden;
      max-width: 100%;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 50%, rgba(0, 188, 212, 0.05) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(249, 115, 22, 0.05) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    /* Loading Animation */
    .loading-overlay {
      position: fixed;
      top: 70px;
      left: 0;
      width: 100%;
      height: calc(100vh - 70px);
      background: var(--color-bg);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 99;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .loading-overlay.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 3px solid rgba(0, 188, 212, 0.2);
      border-radius: 50%;
      border-top-color: var(--color-accent);
      animation: spin 0.8s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      color: var(--color-text-muted);
      font-size: 0.9em;
      text-align: center;
      max-width: 200px;
    }

    /* TOP NAVIGATION */
    .top-nav {
      height: 70px;
      background: rgba(10, 10, 18, 0.9);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1.2rem;
      border-bottom: 1px solid rgba(0, 188, 212, 0.2);
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 15px rgba(0, 0, 0, 0.2);
      touch-action: pan-y;
      max-width: 100%;
      overflow-x: hidden;
    }

    .nav-left { 
      display: flex; 
      align-items: center; 
      gap: 18px; 
    }
    
    .hamburger {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 188, 212, 0.1);
      border-radius: 12px;
      border: 1px solid rgba(0, 188, 212, 0.2);
      color: var(--color-primary);
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .hamburger:hover {
      background: rgba(0, 188, 212, 0.2);
      transform: rotate(90deg);
    }

    .brand {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.3rem;
      font-weight: 700;
      letter-spacing: 1px;
      background: linear-gradient(135deg, var(--color-primary), var(--color-accent-alt));
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      color: transparent;
      text-decoration: none;
      text-shadow: 0 0 20px rgba(0, 188, 212, 0.3);
      cursor: pointer;
      user-select: none;
    }

    /* SIDEBAR */
    .sidebar {
      position: fixed;
      left: -320px;
      top: 0;
      width: 300px;
      height: 100%;
      background: rgba(10, 10, 18, 0.95);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      z-index: 200;
      transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      box-shadow: 10px 0 40px rgba(0, 0, 0, 0.5);
      border-right: 1px solid rgba(0, 188, 212, 0.2);
      padding: 2rem 1.5rem;
      overflow-y: auto;
      touch-action: pan-y;
      max-width: 100%;
      overflow-x: hidden;
    }

    .sidebar.open { left: 0; }
    
    .sidebar-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      z-index: 150;
      opacity: 0;
      transition: opacity 0.3s ease;
      max-width: 100%;
      overflow-x: hidden;
    }
    .sidebar-overlay.active { 
      display: block; 
      opacity: 1;
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(0, 188, 212, 0.2);
    }

    .sidebar-user-info h3 {
      font-family: var(--font-heading);
      font-size: 1.5rem;
      color: var(--color-primary);
      text-align: center;
      width: 100%;
    }

    .sidebar-menu { 
      list-style: none; 
    }
    .sidebar-menu li {
      padding: 16px 20px;
      border-radius: 12px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 18px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.95rem;
      color: var(--color-text-muted);
      text-decoration: none;
    }
    
    .sidebar-menu li a {
      text-decoration: none;
      color: inherit;
      display: flex;
      align-items: center;
      gap: 18px;
      width: 100%;
    }
    
    .sidebar-menu li:hover { 
      background: rgba(0, 188, 212, 0.1);
      color: var(--color-primary);
      transform: translateX(5px);
    }

    .sidebar-menu li i {
      width: 24px;
      text-align: center;
      font-size: 1.1rem;
    }

    .sidebar-divider {
      height: 1px;
      background: rgba(0, 188, 212, 0.2);
      margin: 1.5rem 0;
      opacity: 0.3;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      padding: 80px 20px 60px;
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
      overflow-x: hidden;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .main-content.loaded {
      opacity: 1;
    }

    .edit-profile-container {
      max-width: 100%;
      margin: 0 auto;
      width: 100%;
      overflow-x: hidden;
    }

    .edit-header-section {
      text-align: center;
      margin-bottom: 40px;
      padding: 0 10px;
    }

    .edit-header-section h1 {
      font-family: var(--font-heading);
      font-size: clamp(2em, 5vw, 3em);
      background: linear-gradient(135deg, var(--color-accent), var(--color-accent-alt));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin-bottom: 10px;
      letter-spacing: 2px;
      text-shadow: 0 0 10px rgba(0, 188, 212, 0.3);
      line-height: 1.2;
    }

    .edit-header-section p {
      color: var(--color-text-muted);
      font-size: clamp(1em, 3vw, 1.2em);
      opacity: 0.8;
      line-height: 1.4;
    }

    /* Edit Card Styles */
    .edit-card {
      background: var(--color-bg-light);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 8px 32px rgba(0, 188, 212, 0.1);
      backdrop-filter: blur(10px);
      width: 100%;
      transition: all 0.3s ease;
      overflow-x: hidden;
      max-width: 100%;
      margin-bottom: 30px;
    }

    .edit-card:hover {
      border-color: rgba(0, 188, 212, 0.2);
      box-shadow: 0 10px 40px rgba(0, 188, 212, 0.2);
    }

    .card-title {
      font-family: var(--font-heading);
      font-size: clamp(1.2em, 4vw, 1.5em);
      font-weight: 700;
      color: var(--color-accent);
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Profile Picture Section */
    .profile-picture-section {
      text-align: center;
      margin-bottom: 40px;
    }

    .profile-picture-container {
      position: relative;
      display: inline-block;
      margin-bottom: 20px;
    }

    .profile-picture {
      width: 180px;
      height: 180px;
      border-radius: 50%;
      border: 3px solid var(--color-accent);
      background: linear-gradient(135deg, #0a0a2a, #1a1a3a);
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(0, 188, 212, 0.3);
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .profile-picture img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .profile-picture:hover {
      transform: scale(1.05);
    }

    .profile-picture-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      opacity: 0;
      transition: opacity 0.3s ease;
      border-radius: 50%;
    }

    .profile-picture:hover .profile-picture-overlay {
      opacity: 1;
    }

    .profile-picture-overlay i {
      font-size: 2em;
      margin-bottom: 10px;
    }

    .change-picture-btn {
      display: block;
      background: rgba(0, 188, 212, 0.1);
      color: var(--color-accent);
      border: 1px solid rgba(0, 188, 212, 0.3);
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 0.9em;
      margin: 10px auto;
      transition: all 0.3s ease;
      max-width: 200px;
    }

    .change-picture-btn:hover {
      background: rgba(0, 188, 212, 0.2);
      transform: translateY(-2px);
    }

    .picture-hint {
      color: var(--color-text-muted);
      font-size: 0.85em;
      text-align: center;
      max-width: 300px;
      margin: 0 auto;
    }

    /* Hidden File Input */
    .hidden-file-input {
      display: none;
    }

    /* Form Styles */
    .form-group {
      margin-bottom: 25px;
    }

    .form-label {
      display: block;
      color: var(--color-text);
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 0.95em;
    }

    .form-input {
      width: 100%;
      padding: 14px 16px;
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(0, 188, 212, 0.2);
      border-radius: 10px;
      color: var(--color-text);
      font-size: 1em;
      transition: all 0.3s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--color-accent);
      box-shadow: 0 0 0 3px rgba(0, 188, 212, 0.1);
    }

    .form-textarea {
      width: 100%;
      padding: 14px 16px;
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(0, 188, 212, 0.2);
      border-radius: 10px;
      color: var(--color-text);
      font-size: 1em;
      resize: vertical;
      min-height: 100px;
      transition: all 0.3s ease;
    }

    .form-textarea:focus {
      outline: none;
      border-color: var(--color-accent);
      box-shadow: 0 0 0 3px rgba(0, 188, 212, 0.1);
    }

    .char-count {
      text-align: right;
      font-size: 0.8em;
      color: var(--color-text-muted);
      margin-top: 5px;
    }

    .char-count.near-limit {
      color: var(--color-accent-alt);
    }

    .char-count.over-limit {
      color: var(--color-error);
    }

    /* Status Messages */
    .status-message {
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 0.85em;
      margin-top: 5px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-success {
      background: rgba(16, 185, 129, 0.1);
      color: var(--color-success);
      border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .status-error {
      background: rgba(239, 68, 68, 0.1);
      color: var(--color-error);
      border: 1px solid rgba(239, 68, 68, 0.2);
    }

    .status-info {
      background: rgba(0, 188, 212, 0.1);
      color: var(--color-accent);
      border: 1px solid rgba(0, 188, 212, 0.2);
    }

    .cooldown-badge {
      display: inline-block;
      background: rgba(249, 115, 22, 0.2);
      color: var(--color-accent-alt);
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.75em;
      margin-left: 10px;
    }

    /* Interests Section */
    .interests-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
      margin-bottom: 20px;
    }

    .interest-tag {
      background: rgba(0, 188, 212, 0.15);
      color: var(--color-accent);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9em;
      border: 1px solid rgba(0, 188, 212, 0.3);
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
    }

    .interest-tag:hover {
      background: rgba(0, 188, 212, 0.25);
      transform: translateY(-2px);
    }

    .interest-remove {
      cursor: pointer;
      color: var(--color-text-muted);
      font-size: 0.8em;
      transition: color 0.3s ease;
    }

    .interest-remove:hover {
      color: var(--color-error);
    }

    .interest-input-container {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .interest-input {
      flex: 1;
      padding: 10px 14px;
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(0, 188, 212, 0.2);
      border-radius: 10px;
      color: var(--color-text);
      font-size: 0.95em;
    }

    .add-interest-btn {
      padding: 10px 20px;
      background: rgba(0, 188, 212, 0.2);
      color: var(--color-accent);
      border: 1px solid rgba(0, 188, 212, 0.3);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    .add-interest-btn:hover:not(:disabled) {
      background: rgba(0, 188, 212, 0.3);
      transform: translateY(-2px);
    }

    .add-interest-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .interests-count {
      color: var(--color-text-muted);
      font-size: 0.85em;
      margin-top: 5px;
    }

    /* Social Links */
    .social-input-group {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 10px;
      align-items: center;
      margin-bottom: 15px;
    }

    .social-label {
      color: var(--color-text);
      font-weight: 500;
      font-size: 0.9em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .social-input {
      padding: 10px 14px;
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(0, 188, 212, 0.2);
      border-radius: 10px;
      color: var(--color-text);
      font-size: 0.95em;
      width: 100%;
    }

    /* Privacy Settings */
    .privacy-option {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px;
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(0, 188, 212, 0.2);
      border-radius: 10px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .privacy-option:hover {
      background: rgba(0, 188, 212, 0.1);
      border-color: var(--color-accent);
    }

    .privacy-option.active {
      background: rgba(0, 188, 212, 0.15);
      border-color: var(--color-accent);
    }

    .privacy-label {
      flex: 1;
    }

    .privacy-name {
      font-weight: 600;
      color: var(--color-text);
      margin-bottom: 4px;
    }

    .privacy-description {
      font-size: 0.85em;
      color: var(--color-text-muted);
    }

    .privacy-radio {
      width: 20px;
      height: 20px;
      border: 2px solid rgba(0, 188, 212, 0.3);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .privacy-radio.active::after {
      content: '';
      width: 10px;
      height: 10px;
      background: var(--color-accent);
      border-radius: 50%;
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(255, 255, 255, 0.1);
      transition: .4s;
      border-radius: 24px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .toggle-slider {
      background-color: var(--color-accent);
    }

    input:checked + .toggle-slider:before {
      transform: translateX(26px);
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      margin-top: 40px;
      padding: 20px 0;
      border-top: 1px solid rgba(0, 188, 212, 0.2);
    }

    .cancel-btn, .save-btn {
      padding: 15px 30px;
      border-radius: 10px;
      font-family: var(--font-heading);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      font-size: 1em;
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .cancel-btn {
      background: rgba(255, 255, 255, 0.05);
      color: var(--color-text);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .cancel-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-2px);
    }

    .save-btn {
      background: linear-gradient(135deg, var(--color-accent), var(--color-accent-alt));
      color: white;
      border: none;
      box-shadow: 0 4px 20px rgba(0, 188, 212, 0.3);
    }

    .save-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(0, 188, 212, 0.5);
    }

    .save-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .save-btn.saving {
      background: linear-gradient(135deg, #666, #888);
    }

    .save-btn.success {
      background: linear-gradient(135deg, var(--color-success), #059669);
    }

    /* Saved Message */
    .saved-message {
      position: fixed;
      top: 100px;
      right: 20px;
      background: rgba(16, 185, 129, 0.9);
      color: white;
      padding: 15px 25px;
      border-radius: 10px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 1000;
      transform: translateX(120%);
      transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .saved-message.show {
      transform: translateX(0);
    }

    /* Logout Dialog */
    .logout-dialog {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(5, 5, 26, 0.95);
      justify-content: center;
      align-items: center;
      z-index: 9999;
      padding: 20px;
      backdrop-filter: blur(10px);
      max-width: 100%;
      overflow-x: hidden;
    }

    .logout-dialog.active {
      display: flex;
    }

    .logout-content {
      background: rgba(15, 17, 30, 0.95);
      padding: 30px;
      border-radius: 16px;
      max-width: 400px;
      width: 90%;
      border: 1px solid rgba(0, 188, 212, 0.2);
      box-shadow: 0 0 40px rgba(0, 188, 212, 0.3);
      backdrop-filter: blur(10px);
      text-align: center;
    }

    .logout-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 20px;
    }

    .logout-confirm-btn, .logout-cancel-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-family: var(--font-body);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 100px;
    }

    .logout-confirm-btn {
      background: linear-gradient(135deg, #ff4757, #ff3742);
      color: #ffffff;
    }

    .logout-confirm-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(255, 71, 87, 0.4);
    }

    .logout-cancel-btn {
      background: rgba(255, 255, 255, 0.1);
      color: #ffffff;
      border: 1px solid rgba(0, 188, 212, 0.2);
    }

    .logout-cancel-btn:hover {
      background: rgba(0, 188, 212, 0.1);
      border-color: var(--color-accent);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .main-content {
        padding: 70px 15px 40px;
      }
      
      .edit-card {
        padding: 20px;
      }
      
      .profile-picture {
        width: 140px;
        height: 140px;
      }
      
      .top-nav {
        height: 65px;
        padding: 0 1rem;
      }
      
      .brand {
        font-size: 1.1rem;
      }
      
      .social-input-group {
        grid-template-columns: 1fr;
        gap: 5px;
      }
      
      .action-buttons {
        flex-direction: column;
      }
    }

    @media (max-width: 480px) {
      .main-content {
        padding: 70px 10px 30px;
      }
      
      .interest-input-container {
        flex-direction: column;
      }
      
      .add-interest-btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <div class="loading-text">Loading your profile...</div>
  </div>

  <!-- Top Navigation -->
  <nav class="top-nav">
    <div class="nav-left">
      <div class="hamburger" onclick="toggleSidebar()"><i class="fa-solid fa-bars"></i></div>
      <a href="../homepage.html" class="brand">MOTION-FLOW</a>
    </div>
  </nav>

  <!-- Sidebar Overlay -->
  <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
  
  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-user-info">
        <h3 style="font-size: 1.5rem; color: var(--color-primary); text-align: center; width: 100%;">
          MOTION FLOW
        </h3>
      </div>
    </div>

    <ul class="sidebar-menu">
      <li><a href="../homepage.html"><i class="fas fa-home"></i> Home</a></li>
      <li><a href="../Users/users.html"><i class="fas fa-users"></i> Users</a></li>
      <li><a href="../Chats/chats.html"><i class="fas fa-comments"></i> Messages</a></li>
      <li><a href="../Live_Chat/live.html"><i class="fas fa-comment-dots"></i> Live Chat</a></li>
      <li><a href="../Settings/settings.html"><i class="fas fa-cog"></i> Settings</a></li>
    </ul>

    <div class="sidebar-divider"></div>

    <ul class="sidebar-menu">
      <li onclick="showLogoutDialog()" style="color: #ef4444; cursor: pointer;"><i class="fas fa-sign-out-alt"></i> Logout</li>
    </ul>
  </div>

  <!-- Main Content -->
  <div class="main-content" id="mainContent">
    <div class="edit-profile-container">
      <div class="edit-header-section">
        <h1>Edit Profile</h1>
        <p>Update your profile information and settings</p>
      </div>

      <!-- Profile Picture Section -->
      <div class="edit-card">
        <div class="card-title">
          <i class="fas fa-camera"></i>
          Profile Picture
        </div>
        <div class="profile-picture-section">
          <div class="profile-picture-container">
            <div class="profile-picture" id="profilePicture" onclick="selectProfilePicture()">
              <div id="profilePicturePreview" style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--color-accent);">
                <i class="fas fa-user" style="font-size: 4em;"></i>
              </div>
              <div class="profile-picture-overlay">
                <i class="fas fa-camera"></i>
                <span>Change Picture</span>
              </div>
            </div>
          </div>
          <button class="change-picture-btn" onclick="selectProfilePicture()">
            <i class="fas fa-sync-alt"></i> Change Profile Picture
          </button>
          <p class="picture-hint">Click on the picture or text to upload a new profile picture</p>
          <input type="file" id="profilePictureInput" class="hidden-file-input" accept="image/*">
        </div>
      </div>

      <!-- Basic Information -->
      <div class="edit-card">
        <div class="card-title">
          <i class="fas fa-user-circle"></i>
          Basic Information
        </div>
        
        <div class="form-group">
          <label class="form-label">Full Name</label>
          <input type="text" class="form-input" id="fullName" placeholder="Your full name">
        </div>
        
        <div class="form-group">
          <label class="form-label">Location</label>
          <input type="text" class="form-input" id="location" placeholder="City, Country">
        </div>
        
        <div class="form-group">
          <label class="form-label">Bio</label>
          <textarea class="form-textarea" id="bio" placeholder="Tell others about yourself..." maxlength="250"></textarea>
          <div class="char-count" id="bioCharCount">0/250</div>
        </div>
      </div>

      <!-- Username & Display Name -->
      <div class="edit-card">
        <div class="card-title">
          <i class="fas fa-at"></i>
          Username & Display Name
        </div>
        
        <div class="form-group">
          <label class="form-label">Username</label>
          <input type="text" class="form-input" id="username" placeholder="Choose a username">
          <div class="status-message" id="usernameStatus" style="display: none;">
            <i class="fas fa-check-circle"></i>
            <span>Username is available</span>
          </div>
          <div class="cooldown-badge" id="usernameCooldown" style="display: none;">Can change username in 20 days</div>
          <p class="picture-hint">Unique identifier. Can be changed every 20 days.</p>
        </div>
        
        <div class="form-group">
          <label class="form-label">Display Name</label>
          <input type="text" class="form-input" id="displayName" placeholder="Choose a display name">
          <div class="cooldown-badge" id="displayNameCooldown" style="display: none;">Can change display name in 10 days</div>
          <p class="picture-hint">Display name visible to others. Can be changed every 10 days.</p>
        </div>
      </div>

      <!-- Interests -->
      <div class="edit-card">
        <div class="card-title">
          <i class="fas fa-heart"></i>
          Interests
        </div>
        
        <p class="picture-hint">Add your interests (up to 5)</p>
        
        <div class="interests-container" id="interestsContainer">
          <!-- Interests will be loaded here -->
        </div>
        
        <div class="interests-count" id="interestsCount">0/5 interests</div>
        
        <div class="interest-input-container">
          <input type="text" class="interest-input" id="interestInput" placeholder="Type an interest...">
          <button class="add-interest-btn" id="addInterestBtn" onclick="addInterest()">Add</button>
        </div>
      </div>

      <!-- Social Links -->
      <div class="edit-card">
        <div class="card-title">
          <i class="fas fa-share-alt"></i>
          Social Links
        </div>
        
        <div class="social-input-group">
          <label class="social-label">
            <i class="fab fa-tiktok"></i>
            TikTok
          </label>
          <input type="text" class="social-input" id="tiktok" placeholder="username (without @)">
        </div>
        
        <div class="social-input-group">
          <label class="social-label">
            <i class="fab fa-youtube"></i>
            YouTube
          </label>
          <input type="text" class="social-input" id="youtube" placeholder="username or channel URL">
        </div>
        
        <div class="social-input-group">
          <label class="social-label">
            <i class="fab fa-instagram"></i>
            Instagram
          </label>
          <input type="text" class="social-input" id="instagram" placeholder="username (without @)">
        </div>
      </div>

      <!-- Privacy Settings -->
      <div class="edit-card">
        <div class="card-title">
          <i class="fas fa-shield-alt"></i>
          Privacy Settings
        </div>
        
        <div class="form-group">
          <label class="form-label">Profile Visibility</label>
          
          <div class="privacy-option" data-value="public" onclick="selectPrivacyOption('public')">
            <div class="privacy-label">
              <div class="privacy-name">Public</div>
              <div class="privacy-description">Anyone can see your profile</div>
            </div>
            <div class="privacy-radio" id="privacyPublicRadio"></div>
          </div>
          
          <div class="privacy-option" data-value="friends" onclick="selectPrivacyOption('friends')">
            <div class="privacy-label">
              <div class="privacy-name">Friends Only</div>
              <div class="privacy-description">Only your friends can see</div>
            </div>
            <div class="privacy-radio" id="privacyFriendsRadio"></div>
          </div>
          
          <div class="privacy-option" data-value="private" onclick="selectPrivacyOption('private')">
            <div class="privacy-label">
              <div class="privacy-name">Private</div>
              <div class="privacy-description">Only you can see</div>
            </div>
            <div class="privacy-radio" id="privacyPrivateRadio"></div>
          </div>
        </div>
        
        <div class="form-group">
          <div style="display: flex; align-items: center; justify-content: space-between; padding: 15px 0;">
            <div>
              <div class="form-label" style="margin-bottom: 5px;">Show Email on Profile</div>
              <div class="picture-hint">Allow others to see your email address</div>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="showEmailToggle">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button class="cancel-btn" onclick="goBack()">
          <i class="fas fa-times"></i> Cancel
        </button>
        <button class="save-btn" id="saveBtn" onclick="saveProfile()">
          <i class="fas fa-save"></i> Save Changes
        </button>
      </div>
    </div>
  </div>

  <!-- Saved Message -->
  <div class="saved-message" id="savedMessage">
    <i class="fas fa-check-circle"></i>
    <span>Profile saved successfully!</span>
  </div>

  <!-- Logout Confirmation Dialog -->
  <div class="logout-dialog" id="logoutDialog">
    <div class="logout-content">
      <h2>Logout Confirmation</h2>
      <p>Are you sure you want to logout of your account?</p>
      <div class="logout-buttons">
        <button class="logout-confirm-btn" id="logoutConfirm">Yes, Logout</button>
        <button class="logout-cancel-btn" id="logoutCancel">Cancel</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { 
      getFirestore, 
      getDoc, 
      doc,
      updateDoc
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    import { 
      onAuthStateChanged, 
      getAuth, 
      signOut 
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCy5uQGcg1cALqFSa1xAQOL6lX8Gz5nFNU",
      authDomain: "motion-flow-47450.firebaseapp.com",
      databaseURL: "https://motion-flow-47450-default-rtdb.firebaseio.com",
      projectId: "motion-flow-47450",
      storageBucket: "motion-flow-47450.appspot.com",
      messagingSenderId: "686875529848",
      appId: "1:686875529848:web:48edf5164aaaf938cdd38d",
      measurementId: "G-K46N8C1HFQ"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // DOM Elements
    const loadingOverlay = document.getElementById("loadingOverlay");
    const mainContent = document.getElementById("mainContent");
    
    // Profile elements
    const profilePicturePreview = document.getElementById("profilePicturePreview");
    const profilePictureInput = document.getElementById("profilePictureInput");
    
    // Form elements
    const fullNameInput = document.getElementById("fullName");
    const locationInput = document.getElementById("location");
    const bioInput = document.getElementById("bio");
    const bioCharCount = document.getElementById("bioCharCount");
    const usernameInput = document.getElementById("username");
    const usernameStatus = document.getElementById("usernameStatus");
    const usernameCooldown = document.getElementById("usernameCooldown");
    const displayNameInput = document.getElementById("displayName");
    const displayNameCooldown = document.getElementById("displayNameCooldown");
    const interestsContainer = document.getElementById("interestsContainer");
    const interestInput = document.getElementById("interestInput");
    const addInterestBtn = document.getElementById("addInterestBtn");
    const interestsCount = document.getElementById("interestsCount");
    const tiktokInput = document.getElementById("tiktok");
    const youtubeInput = document.getElementById("youtube");
    const instagramInput = document.getElementById("instagram");
    const showEmailToggle = document.getElementById("showEmailToggle");
    const saveBtn = document.getElementById("saveBtn");
    const savedMessage = document.getElementById("savedMessage");
    
    // Privacy elements
    const privacyPublicRadio = document.getElementById("privacyPublicRadio");
    const privacyFriendsRadio = document.getElementById("privacyFriendsRadio");
    const privacyPrivateRadio = document.getElementById("privacyPrivateRadio");
    
    // Sidebar elements
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    const logoutDialog = document.getElementById('logoutDialog');
    const logoutConfirm = document.getElementById('logoutConfirm');
    const logoutCancel = document.getElementById('logoutCancel');

    let sidebarOpen = false;
    let currentUserId = null;
    let currentUserData = null;
    let interests = [];
    let selectedPrivacy = "public";
    let originalData = {};
    let selectedImageFile = null;
    let selectedImageDataUrl = null;

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      console.log('Edit profile page loaded');
      showLoading();
      setupEventListeners();
    });

    // Setup event listeners
    function setupEventListeners() {
      // Bio character count
      bioInput.addEventListener('input', updateBioCharCount);
      
      // Interest input
      interestInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          addInterest();
        }
      });
      
      // Username availability check
      usernameInput.addEventListener('input', debounce(checkUsernameAvailability, 500));
      
      // Profile picture file selection
      profilePictureInput.addEventListener('change', handleProfilePictureSelect);
      
      // Save button state
      const formElements = [fullNameInput, locationInput, bioInput, usernameInput, 
                          displayNameInput, tiktokInput, youtubeInput, instagramInput];
      formElements.forEach(element => {
        element.addEventListener('input', updateSaveButtonState);
      });
      
      bioInput.addEventListener('input', updateSaveButtonState);
      showEmailToggle.addEventListener('change', updateSaveButtonState);
      interestInput.addEventListener('input', updateSaveButtonState);
    }

    // Show loading animation
    function showLoading() {
      loadingOverlay.classList.remove('hidden');
      void loadingOverlay.offsetWidth;
    }

    // Hide loading animation
    function hideLoading() {
      setTimeout(() => {
        loadingOverlay.classList.add('hidden');
        mainContent.classList.add('loaded');
      }, 300);
    }

    // Select profile picture
    window.selectProfilePicture = function() {
      profilePictureInput.click();
    }

    // Handle profile picture selection
    function handleProfilePictureSelect(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      // Check file size (max 5MB)
      if (file.size > 5 * 1024 * 1024) {
        showMessage('Image size should be less than 5MB', 'error');
        return;
      }
      
      // Check file type
      if (!file.type.match('image.*')) {
        showMessage('Please select an image file', 'error');
        return;
      }
      
      selectedImageFile = file;
      
      // Create data URL for preview
      const reader = new FileReader();
      reader.onload = function(e) {
        selectedImageDataUrl = e.target.result;
        profilePicturePreview.innerHTML = `<img src="${selectedImageDataUrl}" alt="Profile Preview" style="width: 100%; height: 100%; object-fit: cover;">`;
        updateSaveButtonState();
      };
      reader.readAsDataURL(file);
    }

    // Update bio character count
    function updateBioCharCount() {
      const length = bioInput.value.length;
      bioCharCount.textContent = `${length}/250`;
      
      if (length >= 240) {
        bioCharCount.classList.add('near-limit');
      } else {
        bioCharCount.classList.remove('near-limit');
      }
      
      if (length > 250) {
        bioCharCount.classList.add('over-limit');
        bioInput.value = bioInput.value.substring(0, 250);
        bioCharCount.textContent = `250/250`;
      } else {
        bioCharCount.classList.remove('over-limit');
      }
    }

    // Add interest
    function addInterest() {
      const interest = interestInput.value.trim();
      
      if (!interest) return;
      
      if (interests.length >= 5) {
        showMessage('You can only add up to 5 interests', 'error');
        return;
      }
      
      if (interests.includes(interest)) {
        showMessage('This interest is already added', 'error');
        return;
      }
      
      interests.push(interest);
      renderInterests();
      interestInput.value = '';
      updateInterestsCount();
      updateSaveButtonState();
    }

    // Remove interest
    function removeInterest(index) {
      interests.splice(index, 1);
      renderInterests();
      updateInterestsCount();
      updateSaveButtonState();
    }

    // Render interests
    function renderInterests() {
      interestsContainer.innerHTML = '';
      
      interests.forEach((interest, index) => {
        const tag = document.createElement('div');
        tag.className = 'interest-tag';
        tag.innerHTML = `
          ${interest}
          <span class="interest-remove" onclick="removeInterest(${index})">
            <i class="fas fa-times"></i>
          </span>
        `;
        interestsContainer.appendChild(tag);
      });
    }

    // Update interests count
    function updateInterestsCount() {
      interestsCount.textContent = `${interests.length}/5 interests`;
      addInterestBtn.disabled = interests.length >= 5;
    }

    // Select privacy option
    window.selectPrivacyOption = function(value) {
      selectedPrivacy = value;
      
      // Update radio buttons
      privacyPublicRadio.classList.remove('active');
      privacyFriendsRadio.classList.remove('active');
      privacyPrivateRadio.classList.remove('active');
      
      if (value === 'public') {
        privacyPublicRadio.classList.add('active');
      } else if (value === 'friends') {
        privacyFriendsRadio.classList.add('active');
      } else if (value === 'private') {
        privacyPrivateRadio.classList.add('active');
      }
      
      // Update privacy option styling
      document.querySelectorAll('.privacy-option').forEach(option => {
        option.classList.remove('active');
      });
      document.querySelector(`.privacy-option[data-value="${value}"]`).classList.add('active');
      
      updateSaveButtonState();
    }

    // Check username availability
    async function checkUsernameAvailability() {
      const username = usernameInput.value.trim();
      
      if (!username) {
        usernameStatus.style.display = 'none';
        return;
      }
      
      // For demo purposes, simulate availability check
      // In production, you would check against your database
      setTimeout(() => {
        if (username.length >= 3 && !username.includes(' ')) {
          usernameStatus.className = 'status-message status-success';
          usernameStatus.innerHTML = '<i class="fas fa-check-circle"></i><span>Username is available</span>';
          usernameStatus.style.display = 'flex';
        } else {
          usernameStatus.className = 'status-message status-error';
          usernameStatus.innerHTML = '<i class="fas fa-exclamation-circle"></i><span>Username is invalid</span>';
          usernameStatus.style.display = 'flex';
        }
      }, 500);
    }

    // Debounce function for username check
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    // Update save button state
    function updateSaveButtonState() {
      // Check if any field has changed
      const hasChanged = checkIfDataChanged();
      saveBtn.disabled = !hasChanged;
    }

    // Check if data has changed
    function checkIfDataChanged() {
      if (!originalData) return true;
      
      // Check basic info
      if (fullNameInput.value !== originalData.fullName) return true;
      if (locationInput.value !== originalData.location) return true;
      if (bioInput.value !== originalData.bio) return true;
      if (usernameInput.value !== originalData.username) return true;
      if (displayNameInput.value !== originalData.displayName) return true;
      
      // Check if image was selected
      if (selectedImageFile) return true;
      
      // Check interests
      if (JSON.stringify(interests) !== JSON.stringify(originalData.interests || [])) return true;
      
      // Check social links
      if (tiktokInput.value !== (originalData.social?.tiktok || '')) return true;
      if (youtubeInput.value !== (originalData.social?.youtube || '')) return true;
      if (instagramInput.value !== (originalData.social?.instagram || '')) return true;
      
      // Check privacy
      if (selectedPrivacy !== originalData.privacy?.profileVisibility) return true;
      if (showEmailToggle.checked !== originalData.privacy?.showEmail) return true;
      
      return false;
    }

    // Load user profile data
    async function loadUserProfile(userId) {
      try {
        console.log("ðŸ“¥ Loading user profile for:", userId);
        const userDocRef = doc(db, "users", userId);
        const userDoc = await getDoc(userDocRef);
        
        if (userDoc.exists()) {
          const userData = userDoc.data();
          console.log("âœ… User data loaded:", userData);
          currentUserData = userData;
          originalData = JSON.parse(JSON.stringify(userData));
          
          // Populate form fields
          fullNameInput.value = userData.fullName || userData.name || '';
          locationInput.value = userData.location || '';
          bioInput.value = userData.bio || '';
          updateBioCharCount();
          
          // Username & display name
          usernameInput.value = userData.username || '';
          displayNameInput.value = userData.displayName || userData.nickname || '';
          
          // Profile picture
          const profilePic = userData.profileImage || userData.profilePicture || userData.photoURL;
          if (profilePic) {
            profilePicturePreview.innerHTML = `<img src="${profilePic}" alt="Profile Picture" style="width: 100%; height: 100%; object-fit: cover;" onerror="this.onerror=null; this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(userData.displayName || userData.username || 'User')}&background=1a1a2e&color=fff&size=180'">`;
          }
          
          // Interests
          interests = userData.interests || [];
          renderInterests();
          updateInterestsCount();
          
          // Social links
          if (userData.social) {
            tiktokInput.value = userData.social.tiktok || '';
            youtubeInput.value = userData.social.youtube || '';
            instagramInput.value = userData.social.instagram || '';
          }
          
          // Privacy settings
          if (userData.privacy) {
            selectPrivacyOption(userData.privacy.profileVisibility || 'public');
            showEmailToggle.checked = userData.privacy.showEmail || false;
          } else {
            selectPrivacyOption('public');
            showEmailToggle.checked = false;
          }
          
          // Check cooldowns
          checkCooldowns(userData);
          
          hideLoading();
        } else {
          console.error('âŒ User data not found in Firestore');
          // Create a basic profile document if it doesn't exist
          await createUserProfile(userId);
        }
      } catch (error) {
        console.error('âŒ Error loading profile:', error);
        hideLoading();
        showMessage('Error loading profile data', 'error');
      }
    }

    // Create user profile if it doesn't exist
    async function createUserProfile(userId) {
      try {
        console.log("ðŸ†• Creating new user profile for:", userId);
        
        // Get user info from auth
        const user = auth.currentUser;
        
        // Create basic profile data
        const userData = {
          email: user.email,
          username: user.email.split('@')[0],
          displayName: user.displayName || user.email.split('@')[0],
          nickname: user.displayName || user.email.split('@')[0],
          fullName: user.displayName || '',
          bio: '',
          location: '',
          interests: [],
          social: {},
          privacy: {
            profileVisibility: 'public',
            showEmail: false
          },
          profileCompleted: true,
          createdAt: new Date().toISOString()
        };
        
        // Save to Firestore
        const userDocRef = doc(db, "users", userId);
        await updateDoc(userDocRef, userData);
        
        console.log("âœ… New user profile created");
        
        // Reload the data
        await loadUserProfile(userId);
        
      } catch (error) {
        console.error('âŒ Error creating user profile:', error);
        showMessage('Error creating profile', 'error');
        // Redirect to profile page
        setTimeout(() => {
          window.location.href = 'profile.html';
        }, 2000);
      }
    }

    // Check cooldowns
    function checkCooldowns(userData) {
      if (userData.lastChanged) {
        // Username cooldown (20 days)
        if (userData.lastChanged.username) {
          const lastChange = new Date(userData.lastChanged.username);
          const now = new Date();
          const diffDays = Math.floor((now - lastChange) / (1000 * 60 * 60 * 24));
          const remaining = 20 - diffDays;
          
          if (remaining > 0) {
            usernameCooldown.textContent = `Can change username in ${remaining} days`;
            usernameCooldown.style.display = 'inline-block';
            usernameInput.disabled = true;
            usernameInput.placeholder = 'Cannot change yet';
          }
        }
        
        // Display name cooldown (10 days)
        if (userData.lastChanged.nickname || userData.lastChanged.displayName) {
          const lastChangeDate = userData.lastChanged.nickname || userData.lastChanged.displayName;
          const lastChange = new Date(lastChangeDate);
          const now = new Date();
          const diffDays = Math.floor((now - lastChange) / (1000 * 60 * 60 * 24));
          const remaining = 10 - diffDays;
          
          if (remaining > 0) {
            displayNameCooldown.textContent = `Can change display name in ${remaining} days`;
            displayNameCooldown.style.display = 'inline-block';
            displayNameInput.disabled = true;
            displayNameInput.placeholder = 'Cannot change yet';
          }
        }
      }
    }

    // Convert image file to base64
    function convertImageToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
        reader.readAsDataURL(file);
      });
    }

    // Save profile
    window.saveProfile = async function() {
      try {
        console.log("ðŸš€ Starting save profile...");
        
        // Update save button state
        saveBtn.disabled = true;
        saveBtn.classList.add('saving');
        saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
        
        const updates = {};
        let hasChanges = false;
        
        console.log("ðŸ“ Checking for changes...");
        
        // Basic info
        if (fullNameInput.value !== originalData.fullName) {
          updates.fullName = fullNameInput.value.trim();
          hasChanges = true;
          console.log("ðŸ“ Full name changed");
        }
        
        if (locationInput.value !== originalData.location) {
          updates.location = locationInput.value.trim();
          hasChanges = true;
          console.log("ðŸ“ Location changed");
        }
        
        if (bioInput.value !== originalData.bio) {
          updates.bio = bioInput.value.trim();
          hasChanges = true;
          console.log("ðŸ“ Bio changed");
        }
        
        // Username & Display Name (only if not in cooldown)
        if (!usernameInput.disabled && usernameInput.value !== originalData.username) {
          updates.username = usernameInput.value.trim().toLowerCase();
          updates.lastChanged = {
            ...(currentUserData.lastChanged || {}),
            username: new Date().toISOString()
          };
          hasChanges = true;
          console.log("ðŸ“ Username changed");
        }
        
        if (!displayNameInput.disabled && displayNameInput.value !== originalData.displayName) {
          updates.displayName = displayNameInput.value.trim();
          updates.nickname = displayNameInput.value.trim();
          updates.lastChanged = {
            ...(updates.lastChanged || currentUserData.lastChanged || {}),
            nickname: new Date().toISOString(),
            displayName: new Date().toISOString()
          };
          hasChanges = true;
          console.log("ðŸ“ Display name changed");
        }
        
        // Handle profile picture (store as base64)
        if (selectedImageFile) {
          console.log("ðŸ–¼ï¸ Converting image to base64...");
          try {
            const base64Image = await convertImageToBase64(selectedImageFile);
            updates.profileImage = base64Image;
            updates.profilePicture = base64Image;
            hasChanges = true;
            console.log("âœ… Image converted to base64");
          } catch (error) {
            console.error("âŒ Error converting image:", error);
            throw new Error("Failed to process image");
          }
        }
        
        // Interests
        if (JSON.stringify(interests) !== JSON.stringify(originalData.interests || [])) {
          updates.interests = interests;
          hasChanges = true;
          console.log("ðŸ“ Interests changed:", interests);
        }
        
        // Social links
        const social = {};
        let socialChanged = false;
        
        if (tiktokInput.value !== (originalData.social?.tiktok || '')) {
          social.tiktok = tiktokInput.value.trim();
          socialChanged = true;
        }
        
        if (youtubeInput.value !== (originalData.social?.youtube || '')) {
          social.youtube = youtubeInput.value.trim();
          socialChanged = true;
        }
        
        if (instagramInput.value !== (originalData.social?.instagram || '')) {
          social.instagram = instagramInput.value.trim();
          socialChanged = true;
        }
        
        if (socialChanged) {
          updates.social = social;
          hasChanges = true;
          console.log("ðŸ“ Social links changed");
        }
        
        // Privacy settings
        const privacy = {};
        let privacyChanged = false;
        
        if (selectedPrivacy !== (originalData.privacy?.profileVisibility || 'public')) {
          privacy.profileVisibility = selectedPrivacy;
          privacyChanged = true;
          console.log("ðŸ“ Privacy visibility changed:", selectedPrivacy);
        }
        
        if (showEmailToggle.checked !== (originalData.privacy?.showEmail || false)) {
          privacy.showEmail = showEmailToggle.checked;
          privacyChanged = true;
          console.log("ðŸ“ Show email changed:", showEmailToggle.checked);
        }
        
        if (privacyChanged) {
          updates.privacy = privacy;
          hasChanges = true;
        }
        
        console.log("âœ… Has changes:", hasChanges);
        console.log("ðŸ“¤ Updates to save:", updates);
        
        // Update Firestore if there are changes
        if (hasChanges) {
          console.log("ðŸ”¥ Updating Firestore...");
          const userDocRef = doc(db, "users", currentUserId);
          console.log("ðŸ“„ Document path:", userDocRef.path);
          
          await updateDoc(userDocRef, updates);
          console.log("âœ… Firestore update successful!");
          
          // Show success message
          saveBtn.classList.remove('saving');
          saveBtn.classList.add('success');
          saveBtn.innerHTML = '<i class="fas fa-check"></i> Saved!';
          
          showSavedMessage();
          
          // Wait a moment, then redirect to profile page
          setTimeout(() => {
            console.log("ðŸ”„ Redirecting to profile page...");
            window.location.href = 'profile.html';
          }, 1500);
          
        } else {
          console.log("â„¹ï¸ No changes to save");
          saveBtn.classList.remove('saving');
          saveBtn.disabled = false;
          saveBtn.innerHTML = '<i class="fas fa-save"></i> Save Changes';
          showMessage("No changes to save", 'info');
        }
        
      } catch (error) {
        console.error('âŒ Error saving profile:', error);
        console.error('Error details:', error.message);
        console.error('Error code:', error.code);
        
        saveBtn.classList.remove('saving');
        saveBtn.disabled = false;
        saveBtn.innerHTML = '<i class="fas fa-save"></i> Save Changes';
        
        showMessage(`Error: ${error.message}`, 'error');
      }
    }

    // Show saved message
    function showSavedMessage() {
      savedMessage.classList.add('show');
    }

    // Show message
    function showMessage(text, type) {
      // Create message element
      const message = document.createElement('div');
      message.className = `status-message status-${type}`;
      message.innerHTML = `
        <i class="fas fa-${type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
        <span>${text}</span>
      `;
      message.style.position = 'fixed';
      message.style.top = '100px';
      message.style.left = '50%';
      message.style.transform = 'translateX(-50%)';
      message.style.zIndex = '1000';
      
      document.body.appendChild(message);
      
      setTimeout(() => {
        message.remove();
      }, 3000);
    }

    // Go back to profile
    window.goBack = function() {
      if (checkIfDataChanged()) {
        if (confirm('You have unsaved changes. Are you sure you want to leave?')) {
          window.location.href = 'profile.html';
        }
      } else {
        window.location.href = 'profile.html';
      }
    }

    // Sidebar functionality
    window.toggleSidebar = function() {
      sidebarOpen = !sidebarOpen;
      if (sidebarOpen) {
        sidebar.classList.add('open');
        sidebarOverlay.classList.add('active');
      } else {
        sidebar.classList.remove('open');
        sidebarOverlay.classList.remove('active');
      }
    }

    // Logout functionality
    window.showLogoutDialog = function() {
      logoutDialog.classList.add('active');
    }

    logoutConfirm.addEventListener("click", async () => {
      try {
        await signOut(auth);
        window.location.href = '../index.html';
      } catch (error) {
        console.error("Logout failed:", error);
        alert("Something went wrong while logging out.");
      }
    });

    logoutCancel.addEventListener("click", () => {
      logoutDialog.classList.remove('active');
    });

    logoutDialog.addEventListener('click', (e) => {
      if (e.target === logoutDialog) {
        logoutDialog.classList.remove('active');
      }
    });

    // Handle escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (sidebarOpen) {
          toggleSidebar();
        }
        if (logoutDialog.classList.contains('active')) {
          logoutDialog.classList.remove('active');
        }
      }
    });

    // Auth state listener
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        currentUserId = user.uid;
        console.log('User authenticated:', currentUserId);
        await loadUserProfile(currentUserId);
      } else {
        console.log("No user logged in");
        window.location.href = "../index.html";
      }
    });

    // Make functions globally available
    window.removeInterest = removeInterest;
    window.selectProfilePicture = selectProfilePicture;
  </script>
</body>
</html>